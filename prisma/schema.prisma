datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  avatarUrl String?

  watchProgress WatchProgress[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Content {
  id             String   @id @default(cuid())
  tmdbId         String   @unique // ID de TMDB
  type           String   // "movie" | "tv"
  title          String
  overview       String?  @db.Text
  posterUrl      String?
  backdropUrl    String?
  releaseDate    String?  // Fecha de estreno/lanzamiento
  runtime        Int?     // Duración en minutos (para películas)
  totalSeasons   Int?     // Total de temporadas (para series)
  totalEpisodes  Int?     // Total de episodios (para series)
  voteAverage    Float?   // Rating de TMDB
  genres         String?  // JSON string con géneros

  watchProgress WatchProgress[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([title])
}

model StreamingPlatform {
  id   String @id @default(cuid())
  name String @unique // "Netflix", "HBO Max", "Disney+", "Cine", etc.
  logo String? // URL del logo

  watchProgress WatchProgress[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WatchProgress {
  id         String   @id @default(cuid())
  userId     String
  contentId  String
  platformId String?  // Plataforma donde se está viendo (opcional)

  // Estado de visualización
  status String // "watching" | "completed" | "pending" | "dropped"

  // Para series
  currentSeason  Int? // Temporada actual
  currentEpisode Int? // Episodio actual

  // Para películas y series (tracking de tiempo opcional)
  progressMinutes Int?     // Minutos vistos
  totalMinutes    Int?     // Duración total
  progressPercent Float?   // Porcentaje de progreso (0-100)

  // Metadatos
  startedAt   DateTime? // Cuándo empezó a verlo
  completedAt DateTime? // Cuándo lo completó
  lastWatched DateTime? // Última vez que lo vio

  user     User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  content  Content             @relation(fields: [contentId], references: [id], onDelete: Cascade)
  platform StreamingPlatform?  @relation(fields: [platformId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, contentId]) // Un progreso por contenido y usuario
  @@index([status])
  @@index([userId, status]) // Para filtrar por usuario y estado
}
